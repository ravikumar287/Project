{% extends "base.html" %}

{% block title %}Scan #{{ scan.id }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">Scan #{{ scan.id }}</h1>
        <div class="card mb-4">
            <div class="card-body">
                <p><strong>URL:</strong> {{ scan.target_url }}</p>
                <p><strong>Date:</strong> {{ scan.date.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                <p><strong>Status:</strong> 
                    {% if scan.status == 'Completed' %}
                    <span class="badge bg-success">Completed</span>
                    {% elif scan.status == 'Running' %}
                    <span class="badge bg-warning">Running</span>
                    {% elif scan.status.startswith('Failed') %}
                    <span class="badge bg-danger">Failed: {{ scan.status[7:] }}</span>
                    {% else %}
                    <span class="badge bg-secondary">Pending</span>
                    {% endif %}
                </p>
            </div>
        </div>
        
        {% if scan.vulnerabilities %}
        <h2 class="mb-3">Vulnerabilities Found: {{ scan.vulnerabilities|length }}</h2>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Severity</th>
                        <th>URL</th>
                        <th>Payload</th>
                    </tr>
                </thead>
                <tbody>
                    {% for vuln in scan.vulnerabilities %}
                    <tr>
                        <td>{{ vuln.type }}</td>
                        <td>
                            {% if vuln.severity == 'Critical' %}
                            <span class="badge bg-danger">Critical</span>
                            {% elif vuln.severity == 'High' %}
                            <span class="badge bg-warning">High</span>
                            {% elif vuln.severity == 'Medium' %}
                            <span class="badge bg-primary">Medium</span>
                            {% else %}
                            <span class="badge bg-secondary">Low</span>
                            {% endif %}
                        </td>
                        <td><a href="{{ vuln.url }}" target="_blank">{{ vuln.url|truncate(50) }}</a></td>
                        <td><code>{{ (vuln.payload or '')|truncate(30) }}</code></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-success">
            No vulnerabilities found in this scan.
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}